# AmmA Production — лендинг и афиша

Одностраничный сайт продюсерского центра AmmA Production с динамической афишей, которая получает события из локального JSON-файла.

## Структура проекта

- `index.html` — главная страница с краткой информацией, слайдером и блоком предпросмотра ближайших событий.
- `afisha.html` — отдельная страница афиши с сеткой мероприятий.
- `afisha.css` — стили для страницы афиши.
- `afisha.js` — клиентский виджет, который загружает события из `baza_afisha.json` и наполняет карточки.
- `main.js` — логика главной страницы: геро-слайдер, модальное окно афиши и загрузка расписания.

- `admin.html` и `admin.js` — локальная админ-панель для редактирования базы афиши и слайдов героя.
- `baza_afisha.json` — база данных спектаклей с полями id, title, date, time, venue, link, image, description и настройками слайдера.


## Локальный запуск

1. Установите зависимости: `npm install`.
2. Задайте ключ администратора в переменной окружения `ADMIN_TOKEN` и запустите сервер:
   - macOS/Linux: `ADMIN_TOKEN=supersecret npm start`
   - Windows (PowerShell): `$env:ADMIN_TOKEN='supersecret'; npm start`
   - Windows (cmd.exe): `set ADMIN_TOKEN=supersecret && npm start`
3. Откройте `http://localhost:3000` и проверьте работу лендинга и афиши.

Сервер на Express отдаёт статические страницы, сохраняет изменения из админ-панели в `baza_afisha.json` и складывает загруженные изображения в каталог `uploads/`. Административные API требуют Bearer-токен из `ADMIN_TOKEN` и отклонят запросы без него.


## Работа с афишей

- Обновляйте список событий в файле `baza_afisha.json`. Каждая запись содержит идентификатор, название, дату, время, площадку, ссылку на билеты (если есть) и изображение.
- Пустая ссылка на покупку приводит к отображению плашки «Скоро в продаже» в карточках.
- Управляйте слайдами героя через поля `showInHero` (флажок отображения) и `heroOrder` (приоритет сортировки).
- Дополнительная информация (описание, команда, галерея) может оставаться в объекте `AFISHA_SUPPLEMENTAL` внутри `main.js` или переехать в JSON — скрипт отдаёт приоритет данным из `baza_afisha.json`.
- Скрипт `afisha.js` по умолчанию обращается к `baza_afisha.json`, но при необходимости можно задать свой endpoint через атрибут `data-afisha-endpoint`.

## Админ-панель

- Откройте `admin.html` в браузере (например, по адресу `http://localhost:3000/admin.html`, если запущен локальный сервер), чтобы загрузить текущий `baza_afisha.json`.
- Вносите изменения в карточки: название, даты, площадку, изображение и ссылку на билеты. Снимите флажок «Показывать в слайдере», чтобы убрать событие из геро-баннера.
- Кнопка «Сохранить изменения» записывает текущие события напрямую в `baza_afisha.json` и сразу обновляет сайт. Для работы требуется валидный ключ из `ADMIN_TOKEN`.
- Используйте кнопки «Скачать JSON» или «Скопировать JSON», чтобы сделать резервную копию и при необходимости заменить файл вручную.
- Через пункт «Импортировать файл…» можно подгрузить ранее экспортированную версию и продолжить редактирование.
- Для каждого события можно загрузить изображение со своего устройства — оно появится в папке `uploads/`, а ссылка подставится автоматически.
- Кнопка «Указать ключ доступа» сохраняет в браузере Bearer-токен, который выдаёт администратор. Без действительного токена сервер вернёт 401/503 и отклонит сохранение и загрузку изображений.


## Пользовательский виджет афиши

Чтобы встроить сетку афиши на любую страницу, добавьте контейнер с атрибутом `data-afisha-root` и подключите `afisha.js`:

```html
<section data-afisha-root data-afisha-limit="3">
    <div data-afisha-grid>Загрузка…</div>
</section>
<script src="afisha.js" defer></script>
```

По умолчанию виджет обращается к `baza_afisha.json`. Можно переопределить URL через атрибут `data-afisha-endpoint`.
